<%- layout("/layouts/boilerplate") %>
  <link rel="stylesheet" href="/css/resetPassword.css">

  <body>
    <div class="page-bg">
      <div class="center-wrapper">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-5">
              <div
                class="card p-4"
                style="
                  background: #ffffff;
                  border-radius: 22px;
                  padding: 35px;
                  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
                  transition: 0.3s;
                "
              >
                <h4
                  class="text-center mb-3"
                  style="font-weight: 700; color: #1a237e; font-size: 1.6rem"
                >
                  Reset Password
                </h4>
                <p
                  class="text-center mb-4"
                  style="color: #5f6368; font-size: 15px"
                >
                  Enter your new password and confirm it below.
                </p>

                <form
                  class="needs-validation"
                  novalidate
                  action="/reset-password"
                  method="POST"
                >
                  <input type="hidden" name="token" value="<%= token %>" />
                  <div class="mb-3">
                    <label for="password" class="form-label"
                      >New Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      name="password"
                      placeholder="Enter new password"
                      required
                    />
                    <div class="invalid-feedback">
                      password should contain atleast one
                      UpperCase,lowercase,number&speicalCharacter
                    </div>
                  </div>

                  <div class="mb-3">
                    <label for="confirmPassword" class="form-label"
                      >Confirm Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="confirmPassword"
                      name="confirmPassword"
                      placeholder="Confirm new password"
                      required
                    />
                    <div class="invalid-feedback">
                      Both passwords must match.
                    </div>
                  </div>

                  <button type="submit" class="btn btn-primary w-100">
                    Reset Password
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
      <script>
        const pass = document.getElementById("password");
        const cpass = document.getElementById("confirmPassword");

        // Password strength: 8 chars, uppercase, lowercase, number, special char
        const passwordRegex =
          /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

        pass.addEventListener("input", () => {
          if (!passwordRegex.test(pass.value)) {
            pass.setCustomValidity(
              "Must be 8+ chars with uppercase, lowercase, number & special character."
            );
          } else {
            pass.setCustomValidity("");
          }
        });

        cpass.addEventListener("input", () => {
          if (cpass.value !== pass.value) {
            cpass.setCustomValidity("Passwords do not match");
          } else {
            cpass.setCustomValidity("");
          }
        });
      </script>
      <script>
        (() => {
          "use strict";
          const forms = document.querySelectorAll(".needs-validation");
          Array.from(forms).forEach((form) => {
            form.addEventListener(
              "submit",
              (event) => {
                if (!form.checkValidity()) {
                  event.preventDefault();
                  event.stopPropagation();
                }
                form.classList.add("was-validated");
              },
              false
            );
          });
        })();
      </script>
    </div>
  </body>
</html>
