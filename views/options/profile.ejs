<% layout('/layouts/boilerplate') %>

 <link rel="stylesheet" href="/css/myProfile.css" />

<div class="container">
  <div class="card">
    
    <div class="profile-header">
     
      <% if(currUser.profilePicture){%>
        <img class="profile-img" src="<%= currUser.profilePicture %>" alt="User" />
      <%} else { %>
        <img class="profile-img" src="https://cdn.pixabay.com/photo/2023/02/18/11/00/icon-7797704_640.png" alt="User" />
      <% } %>
      
      <div>
        <h2><%= currUser.username %></h2>
        <p class="email">
          <% if(currUser.isVerified) {%> 
            <%= currUser.email%> 
          <% }else{%>
            <span class="Email"><%=currUser.email%></span>
            <a href="/resend-verification-link" class="Verify" data-tooltip="Verify Email">
               <i class="fa-solid fa-exclamation"></i> (verify mail)
            </a>
          <% } %>
        </p>
      </div>
      <% if(currUser.profilePicture) {%>
      <div class="delete-profilePic">
        <form 
    class="delete-form" 
    method="POST" 
    action="/updateProfile?_method=PUT" 
    onsubmit="return confirm('Are you sure you want to remove your profile picture?');"
>
    <input type="hidden" name="removePicture" value="true">
    
    <button type="submit" class="delete-btn" title="Remove Profile Picture">
        <i class="fa-regular fa-trash-can"></i>   
    </button>
</form>
      </div>
      <% } %>
      
    </div>

    <form action="/updateProfile?_method=PUT" method="POST"   enctype="multipart/form-data">

      <div class="section-header">
        <div class="section-title">Basic Info</div>
        <button id="editBtn" type="button" class="edit-btn" onclick="toggleEdit(event)">
          Edit
        </button>
      </div>

      <div id="infoView" class="info-box">
        <div class="info-row"><label>Name:</label> <%= currUser.username %></div>
        <div class="info-row"><label>Email:</label> <%= currUser.email%></div>
        <div class="info-row"><label>Age:</label> <%= currUser.age || '__' %></div>
        <div class="info-row"><label>Gender:</label> <%= currUser.gender || '__' %></div>
        <div class="info-row"><label>Phone:</label> <%= currUser.phone || '__' %></div>
      </div>

      <div id="infoEdit" class="info-box" style="display: none">
        <div class="info-row">
          <label>Name:</label>
          <input   autocomplete="off" type="text" name="username" value="<%= currUser.username %>" />
          
        </div>
        <div class="info-row">
          <label>Email:</label>
          <input   autocomplete="off" type="text" name="email" value="<%= currUser.email%>" />
        </div>
        
        <div class="info-row">
          <label>Age:</label>
          <input type="number" name="age" value="<%= currUser.age %>" placeholder="Enter age" />
          
        </div>

        <div class="info-row">
          <label>Gender:</label>
          <select name="gender">
            <option value="" disabled <%= !currUser.gender ? 'selected' : '' %>>Select Gender</option>
            <option value="Male" <%= currUser.gender === 'Male' ? 'selected' : '' %>>Male</option>
            <option value="Female" <%= currUser.gender === 'Female' ? 'selected' : '' %>>Female</option>
            <option value="Other" <%= currUser.gender === 'Other' ? 'selected' : '' %>>Other</option>
          </select>
        </div>

        <div class="info-row">
          <label>Phone:</label>
          <input  autocomplete="off"  type="text" name="phone" value="<%= currUser.phone || '' %>" />
         
        </div>

        <div class="info-row">
          <label>Profile:</label>
          <input type="file" name="profilePicture" />
        </div>
      </div>

      <div class="section-header">
        <div class="section-title">Travel Preferences</div>
      </div>

      <div id="prefView" class="list-box">
        <% if(currUser.preferences && currUser.preferences.length > 0) { %>
          <div class="pref-grid">
            <% for(let pref of currUser.preferences) { %>
              <span class="pref-label" style="cursor: default; background: #e0e7ff; color: #3730a3;"><%= pref %></span>
            <% } %>
          </div>
        <% } else { %>
          <p style="color:#777; font-size:14px; margin:0;">No preferences selected.</p>
        <% } %>
      </div>

      <div id="prefEdit" class="list-box" style="display: none; border:none; padding:0; box-shadow:none; background: transparent;">
        <p style="margin-top:0; margin-bottom:15px; font-size:14px; color:#666;">
          Select everything you love:
        </p>
        
        <div class="pref-grid">
          <% const userPrefs = currUser.preferences || []; %>
          
          <input type="checkbox" id="beach" name="preferences[]" value="Beaches" <%= userPrefs.includes('Beaches') ? 'checked' : '' %>>
          <label for="beach" class="pref-label">üèñÔ∏è Beaches</label>

          <input type="checkbox" id="mountain" name="preferences[]" value="Mountains" <%= userPrefs.includes('Mountains') ? 'checked' : '' %>>
          <label for="mountain" class="pref-label">‚õ∞Ô∏è Mountains</label>

          <input type="checkbox" id="budget" name="preferences[]" value="Low Budget" <%= userPrefs.includes('Low Budget') ? 'checked' : '' %>>
          <label for="budget" class="pref-label">üî• Trending</label>

          <input type="checkbox" id="luxury" name="preferences[]" value="Luxury" <%= userPrefs.includes('Luxury') ? 'checked' : '' %>>
          <label for="luxury" class="pref-label">üíé Luxury</label>
           
          <input type="checkbox" id="farms" name="preferences[]" value="Farms" <%= userPrefs.includes('Farms') ? 'checked' : '' %>>
          <label for="farms" class="pref-label">üöú Farms</label>

       
          <input type="checkbox" id="adventure" name="preferences[]" value="Adventure" <%= userPrefs.includes('Adventure') ? 'checked' : '' %>>
          <label for="adventure" class="pref-label">üßó Adventure</label>

          <input type="checkbox" id="camping" name="preferences[]" value="Camping" <%= userPrefs.includes('Camping') ? 'checked' : '' %>>
          <label for="camping" class="pref-label">‚õ∫ Camping</label>

          <input type="checkbox" id="wildlife" name="preferences[]" value="Wildlife" <%= userPrefs.includes('Wildlife') ? 'checked' : '' %>>
          <label for="wildlife" class="pref-label">ü¶Å Wildlife</label>

      
          <input type="checkbox" id="Castles" name="preferences[]" value="Castles" <%= userPrefs.includes('Castles') ? 'checked' : '' %>>
          <label for="Castles" class="pref-label">üè∞ Castles</label>

          <input type="checkbox" id="Pools" name="preferences[]" value="Art & Culture" <%= userPrefs.includes('Pools') ? 'checked' : '' %>>
          <label for="Pools" class="pref-label">üèä Pools</label>

          <input type="checkbox" id="Iconic Cities" name="preferences[]" value="Iconic Cities" <%= userPrefs.includes('Iconic Cities') ? 'checked' : '' %>>
          <label for="Iconic Cities" class="pref-label">üèôÔ∏è Iconic Cities</label>
          <input type="checkbox" id="arctic" name="preferences[]" value="arctic" <%= userPrefs.includes('Arctic') ? 'checked' : '' %>>
          <label for="arctic" class="pref-label">üßä Arctic</label>


         

        

          <input type="checkbox" id="Domes" name="preferences[]" value="Family" <%= userPrefs.includes('Domes') ? 'checked' : '' %>>
          <label for="Domes" class="pref-label">üèöÔ∏è Domes</label>
          <input type="checkbox" id="Boats" name="preferences[]" value="Boats" <%= userPrefs.includes('Boats') ? 'checked' : '' %>>
          <label for="Boats" class="pref-label">üö§ Boats</label>
        </div>
      </div>

      <button type="submit" id="saveBtn" class="save-btn" style="display: none;">Save Changes</button>

    </form>

    <div class="section-header">
        <form action="/deleteUser?_method=DELETE" method="POST" onsubmit="return confirm('Are you sure want to delete your Account');">
        <button class="btn">Delete Account</button>
        </form>
    </form>
        
    </div>

    
  </div>
</div>

<script>
  function toggleEdit(e) {
    e.preventDefault();
    
    const editBtn = document.getElementById("editBtn");
    const saveBtn = document.getElementById("saveBtn");
    
    const infoView = document.getElementById("infoView");
    const infoEdit = document.getElementById("infoEdit");
    
    const prefView = document.getElementById("prefView");
    const prefEdit = document.getElementById("prefEdit");

    if (infoEdit.style.display === "none") {
      // Switch to EDIT Mode
      infoEdit.style.display = "block";
      infoView.style.display = "none";
      
      prefEdit.style.display = "block";
      prefView.style.display = "none";
      
      saveBtn.style.display = "block";

      editBtn.textContent = "Cancel";
      editBtn.style.background = "#ffffff";
      editBtn.style.color = "white"; // Red text
      editBtn.style.borderColor = "#ff4d4d";
    } else {
      // Switch back to VIEW Mode
      infoEdit.style.display = "none";
      infoView.style.display = "block";
      
      prefEdit.style.display = "none";
      prefView.style.display = "block";
      
      saveBtn.style.display = "none";

      editBtn.textContent = "Edit";
      editBtn.style.background = "#ffffff";
      editBtn.style.color = "white"; // Blue text
      editBtn.style.borderColor = "#007bff";
    }
  }
</script>